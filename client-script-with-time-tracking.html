<!DOCTYPE html>
<html>
<head>
    <title>Avenix Universal Pixel with Time Tracking</title>
</head>
<body>
    <h1>Enhanced Universal Tracking with Time Spent</h1>
    
    <h2>Option 1: Basic Time Tracking (Recommended)</h2>
    <p>Tracks time spent on page and sends on page unload</p>
    
    <pre><code>
&lt;script&gt;
// Avenix Universal Pixel with Time Tracking
(function() {
  var startTime = Date.now();
  var pageURL = window.location.href;
  var sent = false;
  
  function sendPixel(timeSpent) {
    if (sent) return; // Prevent duplicate sends
    sent = true;
    
    var pixel = new Image();
    pixel.src = 'https://avenix-pixel.vercel.app/track?url=' + 
      encodeURIComponent(pageURL) + 
      '&time=' + startTime + 
      '&timeSpent=' + Math.round(timeSpent / 1000) + 
      '&device=' + encodeURIComponent(navigator.userAgent);
    pixel.style.display = 'none';
    document.body.appendChild(pixel);
  }
  
  // Send pixel when user leaves the page
  window.addEventListener('beforeunload', function() {
    var timeSpent = Date.now() - startTime;
    sendPixel(timeSpent);
  });
  
  // Send pixel when page becomes hidden (mobile/tab switching)
  document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
      var timeSpent = Date.now() - startTime;
      sendPixel(timeSpent);
    }
  });
  
  // Fallback: send after 30 seconds if user is still on page
  setTimeout(function() {
    if (!sent) {
      var timeSpent = Date.now() - startTime;
      sendPixel(timeSpent);
    }
  }, 30000);
  
})();
&lt;/script&gt;
    </code></pre>

    <h2>Option 2: With Client ID</h2>
    <p>Same time tracking but with custom client identification</p>
    
    <pre><code>
&lt;script&gt;
// Avenix Universal Pixel with Time Tracking and Client ID
(function() {
  var startTime = Date.now();
  var pageURL = window.location.href;
  var sent = false;
  var clientId = 'CLIENT_ID'; // Replace with actual client ID
  
  function sendPixel(timeSpent) {
    if (sent) return;
    sent = true;
    
    var pixel = new Image();
    pixel.src = 'https://avenix-pixel.vercel.app/track?client=' + clientId + 
      '&url=' + encodeURIComponent(pageURL) + 
      '&time=' + startTime + 
      '&timeSpent=' + Math.round(timeSpent / 1000) + 
      '&device=' + encodeURIComponent(navigator.userAgent);
    pixel.style.display = 'none';
    document.body.appendChild(pixel);
  }
  
  window.addEventListener('beforeunload', function() {
    var timeSpent = Date.now() - startTime;
    sendPixel(timeSpent);
  });
  
  document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
      var timeSpent = Date.now() - startTime;
      sendPixel(timeSpent);
    }
  });
  
  setTimeout(function() {
    if (!sent) {
      var timeSpent = Date.now() - startTime;
      sendPixel(timeSpent);
    }
  }, 30000);
  
})();
&lt;/script&gt;
    </code></pre>

    <h2>Option 3: Advanced with Engagement Tracking</h2>
    <p>Tracks active time (excludes time when tab is not visible)</p>
    
    <pre><code>
&lt;script&gt;
// Avenix Advanced Time Tracking with Engagement
(function() {
  var startTime = Date.now();
  var activeTime = 0;
  var lastActiveTime = startTime;
  var isActive = true;
  var sent = false;
  
  function sendPixel() {
    if (sent) return;
    sent = true;
    
    var totalTime = Date.now() - startTime;
    var finalActiveTime = isActive ? activeTime + (Date.now() - lastActiveTime) : activeTime;
    
    var pixel = new Image();
    pixel.src = 'https://avenix-pixel.vercel.app/track?url=' + 
      encodeURIComponent(window.location.href) + 
      '&time=' + startTime + 
      '&timeSpent=' + Math.round(totalTime / 1000) + 
      '&activeTime=' + Math.round(finalActiveTime / 1000) + 
      '&device=' + encodeURIComponent(navigator.userAgent);
    pixel.style.display = 'none';
    document.body.appendChild(pixel);
  }
  
  // Track when page becomes visible/hidden
  document.addEventListener('visibilitychange', function() {
    var now = Date.now();
    
    if (document.hidden) {
      if (isActive) {
        activeTime += now - lastActiveTime;
        isActive = false;
      }
      sendPixel(); // Send when page becomes hidden
    } else {
      lastActiveTime = now;
      isActive = true;
    }
  });
  
  window.addEventListener('beforeunload', sendPixel);
  
  // Fallback timer
  setTimeout(function() {
    if (!sent) sendPixel();
  }, 30000);
  
})();
&lt;/script&gt;
    </code></pre>

    <h2>üïê What Gets Tracked</h2>
    <ul>
        <li>üìÑ <strong>Page URL</strong> and visit timestamp</li>
        <li>‚è±Ô∏è <strong>Total time spent</strong> on the page (in seconds)</li>
        <li>üëÅÔ∏è <strong>Active time</strong> (Option 3 - excludes hidden time)</li>
        <li>üíª <strong>Device information</strong> and user agent</li>
        <li>üè¢ <strong>Client identification</strong></li>
        <li>üåç <strong>IP address</strong> (server-side)</li>
    </ul>

    <h2>üéØ Tracking Triggers</h2>
    <ul>
        <li>‚úÖ <strong>Page unload</strong> (user navigates away)</li>
        <li>‚úÖ <strong>Tab hidden</strong> (user switches tabs or minimizes)</li>
        <li>‚úÖ <strong>30-second fallback</strong> (ensures tracking even if events don't fire)</li>
        <li>‚úÖ <strong>Prevents duplicates</strong> (only sends once per page visit)</li>
    </ul>

    <h2>üìä Expected Log Data</h2>
    <pre><code>
{
  "event": "page_view",
  "clientId": "example.com",
  "ip": "192.168.1.1",
  "pageURL": "https://example.com/page",
  "eventTime": "2024-01-01T12:00:00.000Z",
  "timeSpentSeconds": 45,
  "userDevice": "Mozilla/5.0...",
  "serverTimestamp": "2024-01-01T12:00:45.000Z",
  "userAgent": "Mozilla/5.0...",
  "referer": "https://google.com"
}
    </code></pre>

</body>
</html> 